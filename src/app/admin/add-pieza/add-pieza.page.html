<ion-header>
  <ion-toolbar>
    <ion-title>Agregar Pieza</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrar()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list>

    <!-- Nombre -->
    <ion-item>
      <ion-label position="floating">Nombre</ion-label>
      <ion-input [(ngModel)]="nombre"></ion-input>
      <ion-button fill="clear" slot="end" (click)="clearNombre()">
        <ion-icon name="trash-bin" color="danger"></ion-icon>
      </ion-button>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.nombre">
      <p class="ion-padding-start">{{ errores.nombre }}</p>
    </ion-text>

    <!-- Descripción -->
    <ion-item>
      <ion-label position="floating">Descripción</ion-label>
      <ion-input [(ngModel)]="descripcion"></ion-input>
      <ion-button fill="clear" slot="end" (click)="clearDescripcion()">
        <ion-icon name="trash-bin" color="danger"></ion-icon>
      </ion-button>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.descripcion">
      <p class="ion-padding-start">{{ errores.descripcion }}</p>
    </ion-text>

    <!-- N° Serie -->
    <ion-item>
      <ion-label position="floating">N° Serie</ion-label>
      <ion-input [(ngModel)]="numero_serie"></ion-input>
      <ion-button fill="clear" slot="end" (click)="clearSerie()">
        <ion-icon name="trash-bin" color="danger"></ion-icon>
      </ion-button>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.numero_serie">
      <p class="ion-padding-start">{{ errores.numero_serie }}</p>
    </ion-text>

    <!-- Stock mínimo -->
    <ion-item>
      <ion-label position="floating">Stock Mínimo</ion-label>
      <ion-input type="number" [(ngModel)]="stock_minimo"></ion-input>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.stock_minimo">
      <p class="ion-padding-start">{{ errores.stock_minimo }}</p>
    </ion-text>

    <!-- Fecha vencimiento -->
    <ion-item>
      <ion-label>Fecha de Vencimiento</ion-label>
      <ion-datetime presentation="date" [(ngModel)]="fecha_vencimiento"></ion-datetime>
      <ion-button fill="clear" slot="end" (click)="clearFecha()">
        <ion-icon name="trash-bin" color="danger"></ion-icon>
      </ion-button>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.fecha_vencimiento">
      <p class="ion-padding-start">{{ errores.fecha_vencimiento }}</p>
    </ion-text>

    <!-- Categoría -->
    <ion-item>
      <ion-label>Categoría</ion-label>
      <ion-select [(ngModel)]="id_categoria">
        <ion-select-option *ngFor="let cat of categorias" [value]="cat.id_categoria">
          {{ cat.nombre }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.id_categoria">
      <p class="ion-padding-start">{{ errores.id_categoria }}</p>
    </ion-text>

    <!-- Marca -->
    <ion-item>
      <ion-label>Marca</ion-label>
      <ion-select [(ngModel)]="id_marca">
        <ion-select-option *ngFor="let m of marcas" [value]="m.id_marca">
          {{ m.nombre }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.id_marca">
      <p class="ion-padding-start">{{ errores.id_marca }}</p>
    </ion-text>

    <!-- Almacén -->
    <ion-item>
      <ion-label>Almacén</ion-label>
      <ion-select [(ngModel)]="id_almacen">
        <ion-select-option *ngFor="let a of almacenes" [value]="a.id_almacen">
          {{ a.nombre }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.id_almacen">
      <p class="ion-padding-start">{{ errores.id_almacen }}</p>
    </ion-text>

    <!-- Cantidad -->
    <ion-item>
      <ion-label position="floating">Cantidad Inicial</ion-label>
      <ion-input type="number" [(ngModel)]="cantidad"></ion-input>
    </ion-item>
    <ion-text color="danger" *ngIf="errores.cantidad">
      <p class="ion-padding-start">{{ errores.cantidad }}</p>
    </ion-text>

    <!-- Imagen -->
    <ion-item>
      <ion-label>Imagen Referencial</ion-label>
      <input type="file" accept="image/*" (change)="onFileChange($event)" />
    </ion-item>
    <ion-item *ngIf="imagen_base64">
      <img [src]="'data:image/jpeg;base64,' + imagen_base64" style="width: 100%; max-height: 250px; object-fit: contain;" />
    </ion-item>
    <ion-button color="medium" expand="block" *ngIf="imagen_base64" (click)="eliminarImagen()">
      Eliminar Imagen
    </ion-button>
    <p></p>
    <p></p>

    <!-- Botón Guardar -->
    <ion-button expand="full" (click)="guardar()">Guardar</ion-button>

  </ion-list>
</ion-content>
