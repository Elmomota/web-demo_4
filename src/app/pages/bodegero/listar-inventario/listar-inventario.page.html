<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/bodeguero-home"></ion-back-button>
    </ion-buttons>
    <ion-title>Inventario</ion-title>
    <ion-buttons slot="end">
      <ion-chip color="danger" (click)="abrirPopover('vencidas', $event)">
        <ion-icon name="alert-circle" color="light" slot="start"></ion-icon>
        <ion-label>{{ piezasVencidas.length }}</ion-label>
      </ion-chip>
      <ion-chip color="warning" (click)="abrirPopover('stock', $event)">
        <ion-icon name="warning" color="light" slot="start"></ion-icon>
        <ion-label>{{ piezasStockBajo.length }}</ion-label>
      </ion-chip>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-item>
    <ion-input [(ngModel)]="search" placeholder="Buscar por nombre o descripción"></ion-input>
  </ion-item>

  <ion-item>
    <ion-label>Categoría</ion-label>
    <ion-select [(ngModel)]="id_categoria" interface="popover">
      <ion-select-option *ngFor="let cat of categorias" [value]="cat.id_categoria">{{ cat.nombre }}</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-button expand="block" (click)="buscar()">Buscar</ion-button>
  <ion-button expand="block" fill="clear" (click)="limpiar()">Limpiar</ion-button>

<ion-list>
  <ion-item *ngFor="let p of piezas">
    <ion-label>
      <h3>{{ p.nombre }} ({{ p.nombre_categoria }})</h3>
      <p>Stock actual: {{ p.cantidad }} | Stock mínimo: {{ p.stock_minimo }}</p>
      <p *ngIf="p.fecha_vencimiento">Vence: {{ p.fecha_vencimiento | date }}</p>
    </ion-label>

    <ion-button slot="end" color="primary" (click)="abrirModal(p)">
      <ion-icon name="create-outline" slot="icon-only"></ion-icon>
    </ion-button>
  </ion-item>
</ion-list>

  <ion-item *ngIf="piezas.length === 0">
    <ion-label>No hay piezas encontradas.</ion-label>
  </ion-item>
</ion-content>
